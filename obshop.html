<!DOCTYPE html>
<html lang="en">
<!--   

Task list
=========

Think about code reuse and start on shopping module

Here it is, obShop

Simple at the moment.

1. Add new
2. Ordering a-z most used
3. user selection ( default )


Primary (btn-primary): rgb(13, 110, 253) - from --bs-primary-rgb.
Secondary (btn-secondary): rgb(108, 117, 125) - from --bs-secondary-rgb.
Success (btn-success): rgb(25, 135, 84) - from --bs-success-rgb.
Info (btn-info): rgb(13, 202, 240) - from --bs-info-rgb.
Warning (btn-warning): rgb(255, 193, 7) - from --bs-warning-rgb.
Danger (btn-danger): rgb(220, 53, 69) - from --bs-danger-rgb.
Light (btn-light): rgb(248, 249, 250) - from --bs-light-rgb.
Dark (btn-dark): rgb(33, 37, 41) - from --bs-dark-rgb.
Link (btn-link): This doesn't have a specific RGB background; 

it's styled to look like a hyperlink by default. However, 
if you're looking at the text color, it uses --bs-link-color 
which is typically --bs-body-color (rgb(33, 37, 41)).







Yes, there are several algorithms and methods to determine a complementary color for text that ensures readability against a given background color. Hereâ€™s a comprehensive overview based on common practices and referenced sources:

Basic Concepts:
Contrast Ratios: The Web Content Accessibility Guidelines (WCAG) provide standards for contrast ratios to ensure text readability, particularly for those with low vision or color blindness. A contrast ratio of at least 4.5:1 is recommended for normal text, with 3:1 for larger text.
Luminance and Lightness: Human perception of color contrast often depends more on lightness (or luminance) than hue. Algorithms often calculate the perceived brightness of colors to decide text color.

Common Algorithms:
Luminance-Based Method:
Formula: 
Convert RGB values to luminance using the formula: luminance = 0.299*R + 0.587*G + 0.114*B where R, G, and B are the normalized values (0 to 1).
If the background's luminance is high, use a dark text color (like black); if low, use a light color (like white).
Simple Implementation: 
python
def contrasting_text_color(hex_color):
    r, g, b = tuple(int(hex_color[i:i+2], 16) for i in (0, 2, 4))
    luminance = (0.299*r + 0.587*g + 0.114*b) / 255
    return '#000000' if luminance > 0.5 else '#FFFFFF'
This approach is simplistic but often effective for ensuring readability.



Complementary Color Calculation:
While not always the best for readability, complementary colors can be calculated by inverting the RGB values (255 - color_value).
 However, this might not yield the best contrast for readability:
Example: For RGB(255, 0, 0), the complement would be RGB(0, 255, 255), which might not be ideal for background colors with medium brightness.

Contrast Checker Tools and Algorithms:
Tools like Contrast-Finder use algorithms to suggest colors with sufficient contrast. 
They can modify one color based on WCAG standards until a valid contrast is achieved.

Advanced Techniques:
APCA (Advanced Perceptual Contrast Algorithm): More accurate than WCAG 2.1 contrast calculations for readability,
considering more aspects of human color perception. However, implementation requires understanding of more complex color theory and isn't as straightforward for quick application.

HSL (Hue, Saturation, Lightness) Method:
Convert the background color to HSL, then use the lightness value to decide if text should be dark or light. 
If the background's lightness (L) is very high or very low, you can choose black or white text respectively.
 For mid-range lightnesses, you might need to adjust based on specific contrast needs.


Considerations:
Color Blindness: Ensure the chosen text color contrasts with the background for different types of color vision deficiencies.
Context: Text size, font weight, and surrounding colors can influence what appears readable.

Implementing these algorithms in a real-world application would involve converting between color models
 (like RGB to HSL or to a perceived luminance model) and potentially adjusting based on empirical testing or user feedback to ensure practical readability.
-->



<head>
  <meta charset="UTF-8">
  <title>GoShop</title>

  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <link id="theCss" rel="stylesheet" href="./obshop.css">
</head>

<body>
  <p id="version" style="padding:0px;margin:0px"> </p>

  <button id="alertBox" class="banner" onClick="alertBox.style.display='none';">
    <p id="alertText" class="center">some text</p>
  </button>

  <div id="topDiv" class="topDiv fixed">
    <button class="test" onclick="saveToDisk()">save to disk</button>
    <button class="test" onclick="loadFromDisk()">load from disk</button>




    <div class="goDiv">
      <button class="bg-light goBadge" onclick="DoDeleteButton()">
        <image src="images/trash.png" style="width:30px; height:30px">
      </button>
      <button class="bg-light goBadge">
        <image src="images/plus.png" onclick="DoNewButton()" style="width:30px; height:30px">
      </button>

      <button onclick="DoUpdateButton()" class="bg-light goBadge" style="width:55px;height:55px;padding:0px">

        <image src="images/ok.png" style="width:45px; height:45px">
      </button>

      <button class="bg-light goBadge" onclick="itemUp()" style="float:right">
        <image src="images/up.png" style="width:30px; height:30px">
      </button>
      <button class="bg-light goBadge" onclick="itemDown()" style="float:left;transform: rotate(180deg);">
        <image src="images/up.png" style="width:30px; height:30px">
      </button>






      <div class="inputDiv">
        <table style="margin:auto;width:80%">
          <tr>
            <td>Name</td>
            <td>
              <input id="itemName" oninput="DoUpdateButton()" type="text" size="10" maxlength="18">
            </td>
          </tr>

          <tr>
            <td>in stock</td>
            <td>
              <button onclick="inStock.value--;DoUpdateButton()" style="margin-left:10px">-</button>
              <input type="number" id="inStock" onclick="inStock.select()" value="0" min="-10" max="100" size="3"
                maxlength="3">
              <button onclick="inStock.value++;DoUpdateButton()">+</button>
            </td>
          </tr>

          <tr>
            <td>to buy</td>
            <td>
              <div style="display:flexbox;">
                <button onclick="toBuy.value--;DoUpdateButton()" style="margin-left:10px">-</button>
                <input type="number" id="toBuy" onclick="toBuy.select()" value="0" min="-10" max="100" size="3"
                  maxlength="3">
                <button onclick="toBuy.value++;DoUpdateButton()">+</button>
              </div>
            </td>
          </tr>

        </table>




      </div>
    </div>


    <div class="dropdown" style="padding-bottom:19px">
      <button type="button" class="btn btn-primary dropdown-toggle btn-item" style="width:90%;padding-bottom: 10px;"
        data-bs-toggle="dropdown">
        Select list type
      </button>
      <ul class="dropdown-menu" style="width:90%;background-color:transparent;  padding-top: 0px;  padding-bottom: 0px;  text-align: center;border: none">
        <li><a class="dropdown-item" style="background-color:rgb(25, 135, 84);border-radius: 10px;" href="#">
            <span style="color:white">Products</span></a></li>
        <li><a class="dropdown-item" style="background-color:rgb(13, 110, 253);border-radius: 10px;" href="#">
            <span style="color:white">Shops</span> </a></li>
        <li><a class="dropdown-item" style="background-color:rgb(33, 37, 41);border-radius: 10px;" href="#" onclick="alert()"> <span
              style="color:white">Catagories</span></a></li>
      </ul>
    </div>

    <div id="divItems"></div>



  </div>


</body>

<!--







-->



<script>

  const Alert = {
    show(message) {
      alertText.innerHTML = "<h3>" + message + "</h3>";
      alertBox.classList.add("animate");
    },

  }

  function gid(id) {
    return document.getElementById(id);
  }
  function getFocusId() {
    let arr = document.getElementsByClassName("hasFocus");
    if (!arr.length) return null;
    let selected = arr[0];
    let id = selected.id;

    let a = id.split("_");
    return a[1];
  }

  function getIndexById(thisId) {

    for (let i = 0; i < Global.itemArray.length; i++) {
      if (thisId == Global.itemArray[i].id) {
        return i;
        break;
      }
    }

  }

  function DoDeleteButton() {
    let itBe;
    if (itBe = getFocusId()) {
      Global.itemArray.splice(getIndexById(itBe), 1);
      clearFocus();
      displayList();

      itemName.value = "";
      toBuy.value = 0;
      inStock.value = 0;
    }
  }



  function formToArray(index) {
    Global.itemArray[index].name = itemName.value;
    Global.itemArray[index].inStock = inStock.value;
    Global.itemArray[index].toBuy = toBuy.value;

    displayList();
  }

  // form to item
  function DoUpdateButton() {


    let thisId = getFocusId();
    if (!thisId) {
      alert("select an item, or click + in menu");
      return;
    }


    for (let i = 0; i < Global.itemArray.length; i++) {
      if (thisId == Global.itemArray[i].id) {
        formToArray(i);
        break;
      }
    }

  }

  function DoNewButton() {

    newItem = Object.create(item);
    newItem.id = getStamp();
    newItem.name = "new item";
    Global.itemArray.unshift(newItem);

    buttonToForm(newItem);

    displayList();

    clearFocus();
    (gid("item_" + newItem.id)).classList.add('hasFocus');

    alert("added a new item");

  }

  function itemUp() {

    let id = getFocusId();
    if (!id) {
      alert("select an item, or select + in menu");
      return;
    }

    idx = getIndexById(id);

    if (!idx) return;
    let thisItemIndex = Global.itemArray[idx];

    Global.itemArray[idx] = Global.itemArray[idx - 1];
    Global.itemArray[idx - 1] = thisItemIndex;

    clearFocus();

    displayList();

    (gid("item_" + id)).classList.add('hasFocus');

  }

  function itemDown() {

    let id = getFocusId();
    if (!id) {
      alert("select an item, or select + to add a new item");
      return;
    }

    let idx = getIndexById(id);

    if (idx + 1 == Global.itemArray.length) return;
    let thisItemIndex = Global.itemArray[idx];

    Global.itemArray[idx] = Global.itemArray[idx + 1];
    Global.itemArray[idx + 1] = thisItemIndex;


    clearFocus();

    displayList();

    (gid("item_" + id)).classList.add('hasFocus');
  }

  const Global = {
    itemArray: [],
    productArray: [],
    depotArray: [],
    superArray: []
  };

  function clearFocus() {
    let arr = document.getElementsByClassName("btn-item");
    for (let i = 0; i < arr.length; i++) {
      arr[i].classList.remove("hasFocus");
    }
  }

  function buttonToForm(item) {
    itemName.value = item.name;
    inStock.value = item.inStock;
    toBuy.value = item.toBuy;

  }

  function selectButton(e) {

    function getItemById(id) {

      let a = id.split("_");
      let thisId = a[1];
      Global.itemArray.forEach
        (item => {
          if (item.id == thisId) {

            buttonToForm(item);

          }
        });
    }


    clearFocus();
    e.currentTarget.classList.add("hasFocus");

    let thisId = e.currentTarget.id;
    let thisItem = getItemById(thisId);

  }

  class obObject {
    constructor(type) {  // Class constructor
      this._type = type;  // Class body/properties
    }
    get(type) { return this._type }
  }

  class obButton extends obObject {
    constructor() {
      super('obButton');
      this.model = mod;
    }

  }
  /*
    function getStamp() {
      let x = Math.random() * 10000000000;
      x = x.toFixed(0);
      return x;
    }
  */

  let saveStamp = 1;
  function getStamp() {
    while (true) {
      let stamp = (new Date().getTime()).toString();

      if (stamp != saveStamp) {
        saveStamp = stamp;
        return stamp;
      }
    }
  }

  /*
  class item {
    constructor(name) {
      this._id = getStamp();
      if (!name)
        this._name = "unknown";
      else this._name = name;
      this._description = "unknown";
      this._inStock = 0;
      this._toBuy = 0;
    }
    get id() {
      return this._id;
    }
    set name(newName) {
      this._name = newName
    }
    get name() {
      return this._name;
    }
    set name(newName) {
      this._name = newName
    }
    get description() {
      return this._description;
    }
    set description(newDescription) {
      this._description = newDescription;
    }
    get inStock() {
      return this._inStock;
    }
    set inStock(newInStock) {
      this._inStock = newInStock;
    }
    get toBuy() {
      return this._toBuy;
    }
    set toBuy(newToBuy) {
      this._toBuy = newToBuy;;
    }

  }
*/
  // debugger;


  const l = location.toString();

  let arr = l.split('?');
  let str = arr[1];
  let u = str.split("=");

  let user = u[1];

  version.innerHTML = "&nbsp;&nbsp; obShop V.0c " + user;

  const item = {
    id: "",
    name: "",
    description: "unknown",
    inStock: "0",
    toBuy: "0"
  }



  let a = [];

  for (let i = 0; i < 20; i++) {
    test = Object.create(item);
    test.id = getStamp();
    test.name = "item " + i;
    test.description = "";
    test.inStock = "0";
    test.toBuy = "0";
    Global.itemArray.push(test); // the working array
  }



  //setInterval(loadFromDisk, 3000);



  function displayList(a, theDiv, type) {
    // debugger;
    if (!a) a = Global.itemArray;
    if (!theDiv) theDiv = divItems;
    if (!type) type = "item";

    let focus = getFocusId();
    divItems.innerHTML = "";
    a.forEach(item => {


      let newButton = document.createElement('button');
      theDiv.appendChild(newButton);

      buttonId = type + "_" + item.id;
      newButton.id = buttonId;
      newButton.classList.add("btn");
      newButton.classList.add("btn-success");
      newButton.classList.add("btn-" + type);
      newButton.innerHTML = item.name + `<span class="badge bg-primary inBadge" style="float:left">`
        + item.inStock + `</span><span class="badge bg-primary inBadge" style="float:right">` + item.toBuy + `</span>`

      const element = gid(buttonId);
      newButton.addEventListener("click", selectButton);

    });

    if (focus) {
      (gid("item_" + focus)).classList.add("hasFocus");
    }
  }


  alertBox.addEventListener("animationend", () => { alertBox.classList.remove("animate"); });

  window.onbeforeunload = function () {
    saveToDisk();
    return null;
  }

  loadFromDisk();
  Global.productArray = Global.itemArray;
  displayList();



  const gItemArray = [];

  function showAlert(message) {
    alertText.innerHTML = "<h3>" + message + "</h3>";
    alertBox.classList.add("animate");
  }


  function saveToDisk() {

    const theData = JSON.stringify(Global.itemArray);

    const xhttp = new XMLHttpRequest();
    var req = "savetodisk.php";
    // let user = User.get();


    //  user = "TESTUSER";
    req += "?filename=" + "autosave_" + user + ".txt";
    ///alert(user + ' save');
    xhttp.open("POST", req);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.onload = function () {

    }
    xhttp.send("data=" + theData);

  }


  function loadFromDisk() {

    const xhttp = new XMLHttpRequest();
    let req = "loadfromdisk.php";
    // let user = "TESTUSER";

    req += "?filename=" + "autosave_" + user + ".txt";
    xhttp.open("POST", req);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.onload = function () {

      let json = this.responseText;
      Global.itemArray = JSON.parse(json);

      displayList();
      showAlert("done load from disk ");

    }
    xhttp.send();
  }

</script>


</html>